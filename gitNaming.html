<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Git Naming</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>

    <div class="container is-fluid">

        <div class="_fixed-grid _has-2-cols">
            <div class="grid">
                <div class="cell is-col-span-2">

                    <section class="section">
                        <div class="container">
                            <h1 class="title">Git Naming</h1>

                            <div class="field is-horizontal">
                                <div class="field-label is-normal">
                                    Repository
                                </div>
                                <div class="field-body">
                                    <div class="field has-addons">
                                        <div class="control is-expanded">
                                            <div class="select is-fullwidth">
                                                <select name="Repos" id="Repos">
													<optgroup label="Feed Dept. Projects">
														<option>https://github.com/coingaming/goat-betradar-integration           </option>
														<option>https://github.com/coingaming/goat-lsport-integration             </option>
														<option>https://github.com/coingaming/goat-odds-storage					  </option>
														<option>https://github.com/coingaming/goat-schema                         </option>
														<option>https://github.com/coingaming/goat-translations                   </option>
														<option>https://github.com/coingaming/tradeart-custom-events-provider     </option>
														<option>https://github.com/coingaming/tradeart-decimal-cricket-integration</option>
														<option>https://github.com/coingaming/tradeart-exefeed-integration        </option>
														<option>https://github.com/coingaming/tradeart-feed-integration-common    </option>
														<option>https://github.com/coingaming/tradeart-feedcore                   </option>
														<option>https://github.com/coingaming/tradeart-feedfactory                </option>
														<option>https://github.com/coingaming/tradeart-files-service              </option>
														<option>https://github.com/coingaming/tradeart-hub-integration            </option>
														<option>https://github.com/coingaming/tradeart-internal-bookmaker         </option>
														<option>https://github.com/coingaming/tradeart-metadata-storage           </option>
														<option>https://github.com/coingaming/tradeart-oddin-integration          </option>
														<option>https://github.com/coingaming/tradeart-subscription-art           </option>
														<option>https://github.com/coingaming/tradeart-tenant-odds-storage        </option>
														<option>https://github.com/coingaming/tradeart-oddsjam-integration        </option>
														<option>https://github.com/coingaming/tradeart-quickbet                   </option>
														<option>https://github.com/coingaming/tradeart-racelab-integration        </option>
														<option>https://github.com/coingaming/tradeart-racinghq-integration       </option>
														<option>https://github.com/coingaming/tradeart-replay-feed                </option>
														<option>https://github.com/coingaming/tradeart-scrape-art                 </option>
														<option>https://github.com/coingaming/tradeart-scrapeart-integration      </option>
														<option>https://github.com/coingaming/tradeart-sportcast-integration      </option>
														<option>https://github.com/coingaming/tradeart-zedrun-integration         </option>
													</optgroup>
													<optgroup label="Risk Dept. Projects">
														<option>https://github.com/coingaming/goat-betsview                       </option>
														<option>https://github.com/coingaming/goat-settlement                     </option>
														<option>https://github.com/coingaming/tradeart-bet-pusher                 </option>
														<option>https://github.com/coingaming/tradeart-bet-ranking                </option>
														<option>https://github.com/coingaming/tradeart-betplacement               </option>
														<option>https://github.com/coingaming/tradeart-betradar-betplacement      </option>
														<option>https://github.com/coingaming/tradeart-decimal-ticket-feed        </option>
														<option>https://github.com/coingaming/tradeart-global-bets-view           </option>
														<option>https://github.com/coingaming/tradeart-player-flagging            </option>
														<option>https://github.com/coingaming/tradeart-player-profiling           </option>
														<option>https://github.com/coingaming/tradeart-risks-aggregator           </option>
														<option>https://github.com/coingaming/tradeart-player-identifier          </option>
														<option>https://github.com/coingaming/tradeart-player-service             </option>
													</optgroup>
													<optgroup label="In-common">
														<option>https://github.com/coingaming/goat-action-log                     </option>
														<option>https://github.com/coingaming/goat-backoffice-api                 </option>
														<option>https://github.com/coingaming/goat-backoffice-authorization       </option>
														<option>https://github.com/coingaming/goat-common                         </option>
														<option>https://github.com/coingaming/goat-customer-authentication        </option>
														<option>https://github.com/coingaming/goat-sportsbet-api                  </option>
														<option>https://github.com/coingaming/tradeart-intent-modules             </option>
														<option>https://github.com/coingaming/tradeart-notifications              </option>
														<option>https://github.com/coingaming/tradeart-racing-common              </option>
													</optgroup>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="control">
                                            <button type="submit" class="button is-primary" id="ReloadTickets2"><span
                                                    class="icon is-small"><i class="fas fa-rotate"></i></span></button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="field is-horizontal">
                                <div class="field-label is-normal">
                                    <label class="label">Task Type</label>
                                </div>
                                <div class="field-body">
                                    <div class="field">
                                        <div class="control">
                                            <label class="radio">
                                                <input type="radio" name="TaskType" value="Emergency" /> Emergency
                                            </label>
                                            <label class="radio">
                                                <input type="radio" name="TaskType" value="JiraTicketId" checked /> Jira ticket id
                                            </label>
											<label class="radio">
                                                <input type="radio" name="TaskType" value="Test" /> Test
                                            </label>
                                            <label class="radio">
                                                <input type="radio" name="TaskType" value="Stage" /> Stage
                                            </label>
                                            <label class="radio">
                                                <input type="radio" name="TaskType" value="Release" /> Release
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
							
							<div class="field is-horizontal">
                                <div class="field-label">
                                </div>
                                <div class="field-body">
									<div class="field-label">
									</div>
                                    <div class="field">
                                        <div class="control">
											<!--
                                            <label class="radio">
                                                <input type="radio" name="PR_From" value="Emergency" /> Emergency
                                            </label>
                                            <label class="radio">
                                                <input type="radio" name="PR_From" value="JiraTicketId" checked /> Jira ticket id
                                            </label>
											-->
											<label class="radio">
                                                <input type="radio" name="PR_From" value="Branch" checked /> Branch
                                            </label>
                                            <label class="radio">
                                                <input type="radio" name="PR_From" value="Master" /> Master
                                            </label>
                                            <label class="radio">
                                                <input type="radio" name="PR_From" value="Test" /> Test
                                            </label>
											<label class="radio">
                                                <input type="radio" name="PR_From" value="Stage" /> Stage
                                            </label>
                                        </div>
                                    </div>
									<div class="field">
										<label class="label">>></label>
									</div>
									<div class="field">
                                        <div class="control">
                                            <label class="radio">
												<input type="radio" name="PR_To" value="Master" checked /> Master
                                            </label>
											<label class="radio">
                                                <input type="radio" name="PR_To" value="Test" /> Test
                                            </label>
                                            <label class="radio">
                                                <input type="radio" name="PR_To" value="Stage" /> Stage
                                            </label>
                                            <label class="radio">
                                                <input type="radio" name="PR_To" value="Release" /> Release
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="field is-horizontal">
                                <div class="field-label is-normal">
                                    Ticket Id
                                </div>
                                <div class="field-body">
                                    <div class="field has-addons">
                                        <div class="control is-expanded">
                                            <input class="input" type="text" id="JiraTicketId" placeholder="Jira ticket id" />
                                        </div>
                                        <div class="control">
                                            <button type="submit" class="button is-primary" id="ReloadTickets"><span
                                                    class="icon is-small"><i class="fas fa-rotate"></i></span></button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--
              <div class="field is-horizontal control is-expanded">
                <div class="field-label is-normal">
                  <label class="radio">
                    <input type="radio" name="JiraTicketId2" value="Emergency" /> Emergency
                  </label>
                </div>
                <div class="field-label is-normal">
                  <label class="radio">
                    <input type="radio" name="JiraTicketId2" value="JiraTicketId" checked /> Jira ticket id
                  </label>
                </div>
                <div class="field-body">
                  <div class="field has-addons">
                    <div class="control is-expanded">
                      <input class="input" type="text" id="JiraTicketId" placeholder="Jira ticket id" />
                    </div>
                    <div class="control">
                      <button type="submit" class="button is-primary" id="ReloadTickets"><span class="icon is-small"><i
                            class="fas fa-rotate"></i></span></button>
                    </div>
                  </div>
                </div>
              </div>
			  -->

                            <!--
              <div class="field has-addons">
                <div class="control is-expanded">
                  <div class="select is-fullwidth">
                    <select name="country">
                      <option value="Argentina">Argentina</option>
                      <option value="Bolivia">Bolivia</option>
                      <option value="Brazil">Brazil</option>
                      <option value="Chile">Chile</option>
                      <option value="Colombia">Colombia</option>
                      <option value="Ecuador">Ecuador</option>
                      <option value="Guyana">Guyana</option>
                      <option value="Paraguay">Paraguay</option>
                      <option value="Peru">Peru</option>
                      <option value="Suriname">Suriname</option>
                      <option value="Uruguay">Uruguay</option>
                      <option value="Venezuela">Venezuela</option>
                    </select>
                  </div>
                </div>
                <div class="control">
                  <button type="submit" class="button is-primary">Load</button>
                </div>
              </div>
              -->

                            <div class="field is-horizontal">
                                <div class="field-label is-normal">
                                    <label class="label">Shortened task information</label>
                                </div>
                                <div class="field-body">
                                    <div class="field">
                                        <div class="control">
                                            <input class="input" type="text" id="TaskInformation"
                                                placeholder="e.g. Fix slow processing" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="field is-horizontal">
                                <div class="field-label is-normal">
                                    <label class="label">Change Type</label>
                                </div>
                                <div class="field-body">
                                    <div class="field is-narrow">
                                        <div class="control">
                                            <div class="select is-fullwidth">
                                                <select id="Type">
                                                    <option value="">(Select)</option>
                                                    <option value="ci">CircleCI, Docker or Helm config changes</option>
                                                    <option value="docs">updating the documentation (for example readme
                                                        file)</option>
                                                    <option value="feature">new feature development</option>
                                                    <option value="fix">fixing some bug or issue (may be an issue that
                                                        was found during feature
                                                        development, not just bug from jira)</option>
                                                    <option value="perf">performance improvement</option>
                                                    <option value="refactor">refactoring code, includes fixing
                                                        SonarCloud code smells and alerts
                                                    </option>
                                                    <option value="revert">reverting some changes</option>
                                                    <option value="style">changing how something look on Frontend (just
                                                        look)</option>
                                                    <option value="tests">writing and fixing unit tests</option>
                                                    <option value="merge">merging 1 branch with another</option>
                                                    <option value="magic">there are no suitable type for what I am
                                                        doing, I am beyond any
                                                        borders!😆
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="fixed-grid has-12-cols">
                                <div class="grid">

                                    <div class="cell is-col-span-2">
                                        <h1 class="title is-4">Branch</h1>
                                    </div>
                                    <div class="cell is-col-span-9"><input class="input" type="text" id="BranchName" />
                                    </div>
                                    <div class="cell"><button class="button copy" for="BranchName"><span
                                                class="icon is-small"><i class="fas fa-copy"></i></span></button></div>

                                    <div class="cell is-col-span-2">
                                        <h1 class="title is-4">Commit</h1>
                                    </div>
                                    <div class="cell is-col-span-9"><input class="input" type="text" id="CommitName" />
                                    </div>
                                    <div class="cell"><button class="button copy" for="CommitName"><span
                                                class="icon is-small"><i class="fas fa-copy"></i></span></button></div>

                                    <div class="cell is-col-span-2">
                                        <h1 class="title is-4">PR URL</h1>
                                    </div>
                                    <div class="cell is-col-span-9"><a href="#" id="PullRequestUrl"></a></div>
                                    <div class="cell"><button class="button copy" for="PullRequestUrl"><span
                                                class="icon is-small"><i class="fas fa-copy"></i></span></button></div>

                                    <div class="cell is-col-span-2">
                                        <h1 class="title is-4">PR Name</h1>
                                    </div>
                                    <div class="cell is-col-span-9"><input class="input" type="text"
                                            id="PullRequestName" /></div>
                                    <div class="cell"><button class="button copy" for="PullRequestName"><span
                                                class="icon is-small"><i class="fas fa-copy"></i></span></button></div>

                                    <div class="cell is-col-span-2">
                                        <h1 class="title is-4">PR Description</h1>
                                    </div>
                                    <div class="cell is-col-span-9"><input class="input" type="text"
                                            id="PullRequestDescription" /></div>
                                    <div class="cell"><button class="button copy" for="PullRequestDescription"><span
                                                class="icon is-small"><i class="fas fa-copy"></i></span></button></div>

                                    <div class="cell is-col-span-2"></div>
                                    <div class="cell is-col-span-10">
                                        <div class="buttons">
                                            <button class="button is-primary" id="save">Save</button>
											<button class="button is-primary" id="task">Task</button>
                                        </div>
                                    </div>

									<div class="cell is-col-span-2">CLI</div>
                                    <div class="cell is-col-span-10">
										<code id="cmdGitCd">cd C:\Projects\coingaming\</code>
									</div>
									<div class="cell is-col-span-2"></div>
                                    <div class="cell is-col-span-10">
										<code id="cmdGitBranch">git checkout -b TRAD-2526-visual-modeling-module</code>
									</div>
									<div class="cell is-col-span-2"></div>
                                    <div class="cell is-col-span-10">
										<a id="gitBranch"></a>
									</div>

                                </div>
								<div class="grid" id="output">
								</div>
                            </div>

                        </div>

                    </section>

                </div>
                <div class="cell">

                    <section class="section">
                        <div class="container">
                            <h1 class="title">History</h1>

                            <div class="select is-multiple">
                                <select size="46" style="overflow: auto; width: 100%; height: 100%;" id="history">
                                </select>
                            </div>

                            <button class="button" id="delete">
                                <span class="icon is-small"><i class="fas fa-trash"></i></span>
                            </button>

                        </div>
                    </section>

                </div>
				
				<div class="cell">

                    <section class="section">
                        <div class="container">
                            <h1 class="title">Tasks</h1>

                            <div class="select is-multiple">
                                <select size="46" style="overflow: auto; width: 100%; height: 100%;" id="tasks">
                                </select>
                            </div>

                            <button class="button" id="delete">
                                <span class="icon is-small"><i class="fas fa-trash"></i></span>
                            </button>

                        </div>
                    </section>

                </div>
            </div>
        </div>

        <script>
			class Task
			{
			    prTitle = "";
				prId = 0;
				repo = "";
				branch = "";
				step = "branch";
				get repoUrl() { return `https://github.com/coingaming/${this.repo}`; }
				get prUrl() { return `${this.repoUrl}/pull/${this.prId}`; }
				get prTitleAndId() { return `${this.prTitle} #${this.prId}`; }
				get branchUrl() { return `${this.repoUrl}/tree/${this.branch}`; }
				
				clone()
				{
					let task = new Task();
					task.prTitle = this.prTitle;
					task.prId = this.prId;
					task.repo = this.repo;
					task.branch = this.branch;
					task.step = this.step;
					return task;
				}
				
				static Create(value)
				{
					let task = new Task();
					task.prTitle = value.prTitle;
					task.prId = value.prId;
					task.repo = value.repo;
					task.branch = value.branch;
					task.step = value.step;
					return task;
				}
			}
			
			let storage =
			{
				get history() { return storage.getIt("history", []); },
				set history(value) { storage.setIt("history", value); },
				get history2() { return storage.getIt("history2", ({})); },
				set history2(value) { storage.setIt("history2", value); },
				get tasks() { return storage.getIt("tasks", ({})); },
				set tasks(value) { storage.setIt("tasks", value); },
				getIt(key, defaultValue)
				{
					return localStorage[key] ? JSON.parse(localStorage[key]) : defaultValue;
				},
				setIt(key, value)
				{
					localStorage[key] = JSON.stringify(value);
				}
			};
			
			let shared =
			{
				//tasks: [],
				getTasksAsArray() { return Object.entries(storage.tasks).map(([key, value]) => value).map(t => Task.Create(t)); },
				getTasks() { return shared.getTasksAsArray().reduce((a, task) => ({ ...a, [task.prTitleAndId]: task}), {}); },
				saveTask(task)
				{
					//const tasks = shared.tasks.reduce((a, task) => ({ ...a, [task.prTitleAndId]: task}), {});
					tasks[task.prTitleAndId] = task;
					storage.tasks = tasks;
				}
			};

            let history = storage.history;
			let history2 = storage.history2;
			let tasks = shared.getTasks();
			let current = {};
			let historySelect, tasksSelect;
			
			const gitBranchDirectons = {
				Emergency: 		{ From: "Branch",	To: "Master" },
				JiraTicketId: 	{ From: "Branch",	To: "Master" },
				//Master: 		{ From: "Master",	To: "Test" },
				Test: 			{ From: "Master",	To: "Test" },
				Stage: 			{ From: "Master",	To: "Stage" },
				Release: 		{ From: "Stage",	To: "Release" }
			};

			String.prototype.hashCode = function()
			{
				var hash = 0,
					i, chr;
				if (this.length === 0)
					return hash;
				for (i = 0; i < this.length; i++)
				{
					chr = this.charCodeAt(i);
					hash = ((hash << 5) - hash) + chr;
					hash |= 0; // Convert to 32bit integer
				}
				return hash;
			}
			
            function addOption(select, key, value)
            {
                select.options[select.options.length] = new Option(value, key);
            }

            const getPullRequestDescription = jiraTicketId => `[${jiraTicketId}](https://coingaming.atlassian.net/browse/${jiraTicketId})`;

			function setStep(stepIndex)
			{
				document.querySelectorAll(".steps .steps-segment").forEach(el => el.classList.remove("is-active"));
				document.querySelector(`.steps .steps-segment:nth-child(${stepIndex})`).classList.add("is-active");
			}

			function addHtml(title, value)
			{
				var output = document.querySelector("#output");
				var div1 = document.createElement("div");
				div1.classList.add("cell");
				div1.classList.add("is-col-span-2");
				div1.innerHTML = title;
				output.append(div1);
				var div2 = document.createElement("div");
				div2.classList.add("cell");
				div2.classList.add("is-col-span-10");
				div2.innerHTML = value;
				output.append(div2);
			}
			
			function addUrl(title, url)
			{
				addHtml(title, `<a href="${url}">${url}</a>`);
			}

            document.addEventListener("DOMContentLoaded", function ()
            {
                //storage.ticketsB = tickets;
                historySelect = document.getElementById("history");

				/*
                for (const item of history)
                {
                    addOption(historySelect, item.key, item.value);
                }
				*/
				for (const key of Object.keys(history2))
				{
					addOption(historySelect, key, key);
				}
				
				tasksSelect = document.getElementById("tasks");
				
				for (const task of shared.getTasksAsArray())
				{
					addOption(tasksSelect, task.prTitleAndId, task.prTitleAndId);
				}

                document.querySelectorAll(".copy").forEach(el =>
                {
                    el.addEventListener("click", e =>
                    {
                        let element = document.getElementById(el.getAttribute("for"));
                        if (element.tagName === "A")
                            navigator.clipboard.writeText(element.href);
                        else
                            navigator.clipboard.writeText(element.value);
                    });
                });

                historySelect.addEventListener("change", e =>
                {
					const commitName = e.target.value;

					let found2 = history2[commitName];
					if (found2)
					{
						setCurrent2(found2);
						return;
					}

					let found = history.find(i => i.key === commitName);
                    if (found)
                    {
                        let bol = found.commitName.split(" ");
                        let leftOver = found.commitName.substring(bol[0].length + 1);
                        let parcala = leftOver.split(":");
                        leftOver = leftOver.substring(parcala[0].length + 1).trim();
                        let jiraTicketId = bol[0];
                        let type = parcala[0];
                        let taskInformation = leftOver;
						
                        let repo = document.getElementById("Repos").value;
                        let pullRequestUrl = "";

                        if (found.pullRequestName === "[Release] [STAGE]")
                        {
                            document.querySelector("input[type=radio][name='TaskType'][value='Stage']").checked = true;
                            pullRequestUrl = `${repo}/compare/staging...master?expand=1`;
                        }
                        else if (found.pullRequestName === "[Release] [PROD]")
                        {
                            document.querySelector("input[type=radio][name='TaskType'][value='Release']").checked = true;
                            pullRequestUrl = `${repo}/compare/release...staging?expand=1`;
                        }
                        else if (jiraTicketId === "Off-story")
                        {
                            document.querySelector("input[type=radio][name='TaskType'][value='Emergency']").checked = true;
                            document.getElementById("JiraTicketId").value = "";
                            pullRequestUrl = `${repo}/compare/${found.branchName}?expand=1`;
                        }
                        else
                        {
                            document.querySelector("input[type=radio][name='TaskType'][value='JiraTicketId']").checked = true;
                            //document.getElementById("JiraTicketId").value = jiraTicketId;
                            pullRequestUrl = `${repo}/compare/${found.branchName}?expand=1`;
                        }

						setCurrent(
							found.branchName,
							found.commitName,
							jiraTicketId,
							taskInformation,
							type,
							found.pullRequestName,
							getPullRequestDescription(jiraTicketId),
							pullRequestUrl);

						/*
						if (current.commitName.includes("2526"))
							current.repo = "https://github.com/coingaming/tradeart-quickbet";
						history2[current.commitName] = JSON.parse(JSON.stringify(current));
						storage.history2 = history2;
						*/
                    }
                });
				
				tasksSelect.addEventListener("change", e =>
                {
					let task = tasks[e.target.value];
					
					/*
						<code id="cmdGitCd">cd C:\Projects\coingaming\</code>
						<code id="cmdGitBranch">git checkout -b TRAD-2526-visual-modeling-module</code>
					*/

					const jiraTicketId = task.prTitle.split("]")[0].split("[")[1];
					
					setCurrent2(
					{
						branchName: task.branch,
						commitName: "",
						jiraTicketId: jiraTicketId,
						taskInformation: "",
						type: "",
						pullRequestName: task.prTitle,
						pullRequestDescription: getPullRequestDescription(jiraTicketId),
						pullRequestUrl: task.prUrl,
						repo: task.repoUrl,
						taskType: document.querySelector("input[type=radio][name='TaskType']:checked").value,
						prFrom: document.querySelector("input[type=radio][name='PR_From']:checked").value,
						prTo: document.querySelector("input[type=radio][name='PR_To']:checked").value
						//taskType: "",
						//prFrom: "",
						//prTo: ""
					});
				
					document.querySelector("#output").innerHTML = "";

                    addUrl("Deploy - Master", `${task.repoUrl}/${task.branch}?expand=1`);
                    //addUrl("Deploy - Test", `${task.repoUrl}/compare/test...master?expand=1`);
                    addUrl("Deploy - Stage", `${task.repoUrl}/compare/staging...master?expand=1`);
                    addUrl("Deploy - Release", `${task.repoUrl}/compare/release...staging?expand=1`);
                    //${task.repoUrl}/compare/test...master?expand=1
                    //${task.repoUrl}/compare/staging...master?expand=1
                    //${task.repoUrl}/compare/release...staging?expand=1

					addUrl("CircleCI - repo",   `https://app.circleci.com/pipelines/github/coingaming/${task.repo}`);
					addUrl("CircleCI - Branch", `https://app.circleci.com/pipelines/github/coingaming/${task.repo}?branch=master`);
					addUrl("CircleCI - Branch", `https://app.circleci.com/pipelines/github/coingaming/${task.repo}?branch=${task.branch}`);
					
					//addUrl("ArgoCD - repo",   `https://argocd.tradingdev.io/applications/argocd/backoffice-authorization-tradeart`);
				    //addUrl("ArgoCD - repo",   `https://argocd.tradingdev.io/applications/argocd/feedfactory-728`);
					//addUrl("ArgoCD - repo",   `https://argocd.tradingdev.io/applications/argocd/${task.repo}`);
					
					addUrl("SonarCloud - Summary", `https://sonarcloud.io/summary/new_code?id=coingaming_${task.repo}&branch=${task.branch}`);
					addUrl("SonarCloud - Measures", `https://sonarcloud.io/component_measures?id=coingaming_${task.repo}&branch=${task.branch}&metric=new_coverage&view=list`);
					
					addHtml("Slack Review <br/> tradeart-dev-team", `@ta.back.dev Please review ${task.repoUrl}/pull/???`);
					addHtml("Slack Deploy <br/> tradeart-dev-team", `@ta.back.dev Deploying custom branch of ${task.repo} on TEST env. ticket [${jiraTicketId}](https://coingaming.atlassian.net/browse/${jiraTicketId})`);
				});
				
                document.getElementById("save").addEventListener("click", e =>
                {
                    //console.log(e.target.value);
                    //history = storage.history;

                    let branchName = document.getElementById("BranchName").value;
                    let commitName = document.getElementById("CommitName").value;
                    let pullRequestName = document.getElementById("PullRequestName").value;

                    let item = {
                        key: commitName,
                        value: `${commitName}`,
                        branchName: branchName,
                        commitName: commitName,
                        pullRequestName: pullRequestName
                    };
					
                    history.push(item);
					storage.history = history;
					
					//history2[current.commitName] = current;
					history2[current.commitName] = JSON.parse(JSON.stringify(current));
                    storage.history2 = history2;

                    addOption(historySelect, item.key, item.value);
                });

				document.getElementById("task").addEventListener("click", e =>
                {
					//let pullRequestName = document.getElementById("PullRequestName").value;
					//let repo = document.getElementById("Repos").value;
					
					let task = new Task();
					task.prTitle = current.pullRequestName;
					task.prId = 0;
					task.repo = current.repo.split("/")[4];
					task.branch = current.branchName;
					
					shared.saveTask(task);
					
					addOption(tasksSelect, task.prTitleAndId, task.prTitleAndId);
				});
				
                document.getElementById("delete").addEventListener("click", e =>
                {
                    const historySelect = document.getElementById("history");
                    const selected = historySelect[historySelect.selectedIndex];
                    //for (const selected of historySelect.selectedOptions)
                    if (selected)
                    {
                        console.log(selected.value);

                        //history = storage.history;
                        let found = history.find(i => i.key === selected.value);

                        if (found)
                        {
                            //if (history.indexOf(found) > -1)
                            history.splice(history.indexOf(found), 1);

                            storage.history = history;
                            selected.remove();
                        }
						
						let found2 = history2[selected.value];

                        if (found2)
                        {
                            delete history2[selected.value];

                            storage.history2 = history2;
                            //selected.remove();
                        }
                    }
                });

                Array.from(document.querySelectorAll("input[type=radio][name='TaskType']")).forEach(element =>
					element.addEventListener("click", e =>
					{
						const taskType = document.querySelector("input[type=radio][name='TaskType']:checked").value;
						
						const gitDirecton = gitBranchDirectons[taskType];

						document.querySelector(`input[type=radio][name="PR_From"][value="${gitDirecton.From}"]`).checked = true;
						document.querySelector(`input[type=radio][name="PR_To"][value="${gitDirecton.To}"]`).checked = true;

						renderNames();
					}));
					
				Array.from(document.querySelectorAll("input[type=radio][name='PR_From']")).forEach(element => element.addEventListener("click", renderNames));
				Array.from(document.querySelectorAll("input[type=radio][name='PR_To']")).forEach(element => element.addEventListener("click", renderNames));

                document.getElementById("JiraTicketId").addEventListener("keyup", renderNames);

                document.getElementById("TaskInformation").addEventListener("keyup", renderNames);

                document.getElementById("Type").addEventListener("change", e => renderNames());

                document.getElementById("ReloadTickets").addEventListener("click", async e =>
                {
                    /*
                    https://coingaming.atlassian.net/rest/api/2/search?jql=assignee=ozgur
                    https://coingaming.atlassian.net/rest/api/2/search?jql=assignee=ozgur.civi@yolo.com
                    https://coingaming.atlassian.net/rest/api/2/search?jql=assignee=712020%3Ad39ed290-c6c9-43da-923c-8c6ebde1fc5e
                    https://coingaming.atlassian.net/rest/api/2/search?jql=project=TRAD+order+by+duedate&fields=id,key,issuetype,status
                    https://coingaming.atlassian.net/rest/api/2/search?jql=project=TRAD+order+by+duedate&status+not+in+('Obsolete','Cancelled','Done','Production')
                    https://coingaming.atlassian.net/rest/api/2/search?jql=project=TRAD+order+by+duedate&status+in+('In planning','Backlog','Reopened','Planned','On Hold','To Do')
                    */
                    const response = await fetch("https://coingaming.atlassian.net/rest/api/2/search?jql=project=TRAD+order+by+duedate&status+in+('In planning','Backlog','Reopened','Planned','On Hold','To Do')",
                        {
                            mode: "cors", // no-cors, *cors, same-origin,
                            credentials: "omit", // include, *same-origin, omit
                            referrerPolicy: "origin" // no-referrer, *no-referrer-when-downgrade, origin
                        });
                    const tickets = await response.json();
                    console.log(tickets);
                    localStorage.ticketsA = tickets;
                    localStorage.ticketsB = JSON.stringify(tickets);
                });

            });

            const renderNames = () =>
            {
                const MaxBranchNameLength = 34;

                const taskType = document.querySelector("input[type=radio][name='TaskType']:checked").value;
				const prFrom = document.querySelector("input[type=radio][name='PR_From']:checked").value;
				const prTo = document.querySelector("input[type=radio][name='PR_To']:checked").value;
                let jiraTicketIdForBranch;
                let jiraTicketIdForCommit;
				const jiraTicketId = jiraTicketIdForBranch = jiraTicketIdForCommit = document.getElementById("JiraTicketId").value;

                if (taskType === "Emergency")
                {
                    jiraTicketIdForBranch = "OFF";
                    jiraTicketIdForCommit = "Off-story";
                }

                let taskInformation = document.getElementById("TaskInformation").value;
                let type = document.getElementById("Type").value;

                let branchName = `${jiraTicketIdForBranch}-${kebabCase(taskInformation)}`;
                let commitName = `${jiraTicketIdForCommit} ${type}: ${taskInformation}`;
                let pullRequestName = `[${jiraTicketIdForCommit}] ${type} ${taskInformation}`;
				let pullRequestDescription = getPullRequestDescription(jiraTicketIdForCommit);

                if (branchName.length > MaxBranchNameLength)
                {
                    branchName = branchName.substring(0, MaxBranchNameLength);
                }

                let pullRequestUrl = "";
                let repo = document.getElementById("Repos").value;

				const gitBranchDict = {
					Branch: branchName,
					Master: "master",
					Test: "test",
					Stage: "staging",
					Release: "release"
				};

				const branchFrom = gitBranchDict[prFrom];
				const branchTo = gitBranchDict[prTo];
				
				pullRequestUrl = `${repo}/compare/${branchTo}...${branchFrom}?expand=1`;

				if (prFrom === prTo)
				{
					pullRequestUrl = "N/A";
				}
				
				if (prTo === "Test")
                {
                    pullRequestName = "[Release] [TEST]";
                }
				else if (prTo === "Stage")
                {
                    pullRequestName = "[Release] [STAGE]";
                }
                else if (prTo === "Release")
                {
                    pullRequestName = "[Release] [PROD]";
                }
                
				if (prFrom === "Branch" && prTo === "Master")
                {
                    //pullRequestUrl = `${repo}/compare/${branchName}?expand=1`;
                    pullRequestUrl = `${repo}/compare/${branchFrom}?expand=1`;
                }

				setCurrent(
					branchName,
					commitName,
					jiraTicketId,
					taskInformation,
					type,
					pullRequestName,
					pullRequestDescription,
					pullRequestUrl);

				if (prTo === "Test" || prTo === "Stage" || prTo === "Release")
                {
					document.getElementById("BranchName").value = "";
					document.getElementById("CommitName").value = "";
					document.getElementById("PullRequestDescription").value = "";
                }
            };

            const kebabCase = string => string
                .replace(/([a-z])([A-Z])/g, "$1-$2")
                .replace(/[\s_]+/g, '-')
                .toLowerCase();

			const setCurrent = (
				branchName,
				commitName,
				jiraTicketId,
				taskInformation,
				type,
				pullRequestName,
				pullRequestDescription,
				pullRequestUrl) =>
			{
				current.branchName = branchName;
				current.commitName = commitName;
				current.jiraTicketId = jiraTicketId;
				current.taskInformation = taskInformation;
				current.type = type;
				current.pullRequestName = pullRequestName;
				current.pullRequestDescription = pullRequestDescription;
				current.pullRequestUrl = pullRequestUrl;

				current.repo = document.getElementById("Repos").value;
				current.taskType = document.querySelector("input[type=radio][name='TaskType']:checked").value;
				current.prFrom = document.querySelector("input[type=radio][name='PR_From']:checked").value;
				current.prTo = document.querySelector("input[type=radio][name='PR_To']:checked").value;

				currentChanged();
			};
			
			const setCurrent2 = (value) =>
			{
				current = JSON.parse(JSON.stringify(value));

				document.getElementById("Repos").value = current.repo;
				document.querySelector(`input[type=radio][name='TaskType'][value='${current.taskType}']`).checked = true;
				document.querySelector(`input[type=radio][name='PR_From'][value='${current.prFrom}']`).checked = true;
				document.querySelector(`input[type=radio][name='PR_To'][value='${current.prTo}']`).checked = true;
				
				currentChanged();
			};
			
			const currentChanged = () =>
			{
				document.getElementById("BranchName").value = current.branchName;
				document.getElementById("CommitName").value = current.commitName;
				document.getElementById("PullRequestName").value = current.pullRequestName;
				document.getElementById("PullRequestDescription").value = current.pullRequestDescription;
				document.getElementById("PullRequestUrl").href = current.pullRequestUrl;
				document.getElementById("PullRequestUrl").innerHTML = current.pullRequestUrl;
				document.getElementById("JiraTicketId").value = current.jiraTicketId;
				document.getElementById("TaskInformation").value = current.taskInformation;
				document.getElementById("Type").value = current.type;
				document.getElementById("cmdGitCd").innerHTML = `cd C:\\Projects\\coingaming\\${current.repo.split("/")[4]}`;
				document.getElementById("cmdGitBranch").innerHTML = `git checkout -b ${current.branchName}`;
				document.getElementById("gitBranch").innerHTML = `${current.repo}/tree/${current.branchName}`;
			};

        </script>

</body>
<html>